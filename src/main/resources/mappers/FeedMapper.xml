<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ht.project.snsproject.mapper.FeedMapper">

    <resultMap id="feedList" type="com.ht.project.snsproject.model.feed.FeedList">
        <id property="id" column="id"/>
        <result property="userId" column="userId"/>
        <result property="title" column="title"/>
        <result property="content" column="content"/>
        <result property="path" column="path"/>
        <result property="date" column="date"/>
        <result property="publicScope" column="publicScope"/>
        <collection property="files" javaType="java.util.ArrayList" resultMap="getFileVo"/>
    </resultMap>

    <resultMap id="getFileVo" type="java.util.HashMap">
        <result property="fileIndex" column="fileIndex"/>
        <result property="fileName" column="fileName"/>
    </resultMap>

    <insert id="feedUpload" parameterType="com.ht.project.snsproject.model.feed.FeedInsert">
        INSERT INTO feeds(userId, title, path, content, date, publicScope)
        Values(#{userId}, #{title}, #{path}, #{content}, #{date}, #{publicScope})
    </insert>

    <select id="getFeedList" parameterType="com.ht.project.snsproject.model.Pagination" resultMap="feedList">
        SELECT a.id, a.userId,
        a.title, a.content,
        a.path, a.date, a.publicScope,
        b.fileName, b.fileIndex
        FROM feeds a LEFT JOIN images b
        on (a.path = b.path)
        AND (a.userId = #{userId})
        <if test="cursor != null">
            WHERE a.id<![CDATA[<]]>#{cursor}
        </if>
        ORDER BY a.id DESC
        LIMIT #{listSize}
    </select>
</mapper>