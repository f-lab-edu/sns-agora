<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ht.project.snsproject.mapper.FeedMapper">

    <resultMap id="feedList" type="com.ht.project.snsproject.model.feed.FeedList">
        <id property="id" column="id"/>
        <result property="userId" column="userId"/>
        <result property="title" column="title"/>
        <result property="content" column="content"/>
        <result property="date" column="date"/>
        <result property="publicScope" column="publicScope"/>
        <result property="recommend" column="recommend"/>
        <collection property="files" javaType="java.util.ArrayList" resultMap="getFileVo"/>
    </resultMap>

    <resultMap id="getFileVo" type="java.util.HashMap">
        <result property="path" column="path"/>
        <result property="fileIndex" column="fileIndex"/>
        <result property="fileName" column="fileName"/>
    </resultMap>

    <insert id="feedUpload" useGeneratedKeys="true" keyProperty="id"
            parameterType="com.ht.project.snsproject.model.feed.FeedInsert">
        INSERT INTO feeds(userId, title, content, date, publicScope, recommend)
        VALUES(#{userId}, #{title}, #{content}, #{date}, #{publicScope}, #{recommend})
    </insert>

    <select id="getFeedList" parameterType="java.util.Map" resultMap="feedList">
        SELECT a.id, a.userId,
        a.title, a.content,
        a.date, a.publicScope, a.recommend,
        b.path, b.fileName, b.fileIndex
        FROM feeds a INNER JOIN images b
        ON (a.id = b.feedId)
        AND (a.userId = #{userId})
        <if test="pagination.cursor != null">
            WHERE a.id<![CDATA[<]]>#{pagination.cursor}
        </if>
        ORDER BY a.id DESC
        LIMIT #{pagination.listSize}
    </select>
</mapper>